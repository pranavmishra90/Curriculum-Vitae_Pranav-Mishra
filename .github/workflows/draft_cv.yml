name: 'Build LaTeX Draft CV'

# Purpose:
#--------------
# This GitHub action is designed to allow the user to see the results / output
# of any changes they have made to their LaTeX file. Note, this is considered
# to be a 'draft review', meaning that the PDF files are not persistent.
# They will be saved as GitHub Action Artifacts and deleted automatically after
# a few days (duration set below). 


# This can serve as an easy alternative to those who do not have a local LaTeX 
# environment and/or if they would like to see the end results as generated by
# tectonic vs. other engines (since this is what will be used for the final 
# commit to the main branch).

# When should this GitHub Action be run
on:
  # Pushes to the following branches
  push:
    branches:
      # - draft
      - feature/*
  # Any Pull Request
  pull_request:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      
      # Biber is used to generate our citations
      - name: Install biber
        run:  sudo apt-get -y install biber
        
      # Tectonic is the LaTeX engine which downloads packages as they are needed  
      - uses: actions/cache@v3
        name: Tectonic Cache
        with:
          path: ~/.cache/Tectonic
          key: ${{ runner.os }}-tectonic-${{ hashFiles('**/*.tex') }}
          restore-keys: |
            ${{ runner.os }}-tectonic-
      - uses: wtfjoke/setup-tectonic@v2
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
      - run: biber --version

      # Create the PDF from TEX file
      - name: Run Tectonic + Biber
        run: tectonic pranav_kumar_mishra_cv.tex --keep-logs


      # Save the PDF as a GitHub Action Artifact
      # These artefacts can be found within the run's summary page
      - name: Upload pdf
        uses: actions/upload-artifact@v3
        with:
          name: pranav_kumar_mishra_cv
          path: pranav_kumar_mishra_cv.pdf
          retention-days: 5 #delete file after 'n' days